# דו"ח התקדמות – 12 בנובמבר 2025

## מה בוצע היום
- הוטמעה לוגיקת חגים מעודכנת (NYSE) בקוד המקור (`backend/utils/market_calendar.py`) ושולבו בדיקות במעמד טעינת הדאטה האינטרדֵיי.
- עודכנו הסקריפטים של ההורדה והטעינה כך שידלגו על ימים בהם הבורסה סגורה, והוסרו התרעות שווא בזמן ריצות ההכשרה.
- הופעלה ריצת עשן קצרה (`python tmp/run_short_walkforward.py`) לווידוא שלמות הפייפליין המעודכן – הריצה הסתיימה בהצלחה ושמרה ארטיפקטים בסיסיים.
- הופעלה ריצה ארוכה (כ~3.3 שעות, 600k צעדים לכל חלון) באמצעות `python tmp/run_short_walkforward.py --mode long ...` עם יצירת מודלים `sac_TNA_v20251112_143023.zip` ו-`sac_TNA_v20251112_174612.zip`.
- נותחו תוצרי ההערכה שנוצרו בתיקיית `backend/evaluation/walk_forward_results/long_run_20251112`, כולל סיכומי חלונות והפרשי ביצועים מול ריצות קודמות.

## בדיקות והרצות
- בדיקות ידניות של טעינת נתוני אינטרדיי (אימות דילוג על חגים) באמצעות ריצות חלקיות של המטעין והסקריפטים הקיימים.
- ריצת עשן (short mode) לווידוא יציבות הפייפליין לאחר שינויים בקלנדר.
- ריצת Walk-forward ארוכה (long mode) הכוללת 3 חלונות אימון/בדיקה מצטברים.

## תובנות עיקריות מהריצה הארוכה
- שני המודלים שהתקבלו (חלונות 2020–2024 ו-2020–2025) הציגו ביצועי מבחן שליליים: שרפ בין ‎-4.7‎ ל-‎-4.9‎, תשואת מבחן ‎≈‎-0.4‎%, כמות טריידים ~215 עם תנודתיות גבוהה.
- קבצי ה-Walk-forward שנוצרו בריצת ההערכה הדטרמיניסטית מציגים 0 טריידים וקרן הון שטוחה – הסיבה היא שהמדיניות חוזה אקשן ממוצע קרוב ל-0, והמתאם לפעולה בדידה מחזיר HOLD. יש צורך בהרצת הערכה סטוכסטית כדי לקבל תמונת ביצועים ריאלית.
- היסטוריית הטריידים במתודי האימון מצביעה על תנודות חריפות (טריידים בודדים של ‎±1–3‎ אלף דולר), המעידה על רמת אקספלורציה גבוהה מדי תחת `ent_coef="auto"` ויעד האנטרופיה הנוכחי.

## מה נשאר פתוח
- הפקת סיכומי הערכה אמינים (כולל ביצועי טריידים בפועל) על-ידי הרצת ההערכה עם פעולות סטוכסטיות או התאמת סף המיפוי ל-HOLD/BUY/SELL.
- מעקב אחר אובדני ה-critic/actor לאורך האימון כדי להבין באיזה שלב מתחיל חוסר היציבות (divergence) באימון הארוך.
- הצלבת התוצאות עם ריצות היסטוריות (2022–2023 וכד׳) כדי לוודא שהשיפור בלוגיקת החגים לא פגע במקטעי דאטה אחרים.

## המלצות להמשך ולשיפור ביצועים
1. להריץ מחדש את ההערכה עם `--stochastic-eval` או לחילופין להפחית את סף ההמרה לאקשן דיסקרטי (±0.33) כדי שהדו"חות ישקפו פעולות אמת.
2. לצמצם רמת אקספלורציה: לקבע `ent_coef` לערך נמוך (≤0.02) או להקטין את `target_entropy`, ולשקול הוספת Gradient Clipping כדי להקטין קפיצות חדות.
3. להקטין את קצב הלמידה (≤1e-4) ולבדוק ריצה ארוכה מצומצמת (חלון בודד) כדי לוודא התכנסות לפני ריצת overnight נוספת.
4. להפיק לוגים מפורטים של הפסדי הקריטיק/אקטור ולשרטט גרפים לאורך הריצה כדי לזהות רגעי התפוצצות (exploding gradients / entropy collapse).

## פעולות עתידיות מתוכננות
- הכנת ריצת Walk-forward ארוכה נוספת לאחר עדכון ההיפר-פרמטרים כדי למדוד את השפעת השינויים.
- הוספת בדיקות יחידה/אינטגרציה שיבחנו מפורשות התנהגות בימי חג ובחלונות מבחן קצרים.
- עדכון מסמכי התפעול (RUNBOOK/PLAN) לאחר שיתקבלו תוצאות משופרות מהריצה הבאה.

## הקשר למעבר למחשב החדש
- סביבת היעד: כרטיס גרפי חזק יותר (6GB RAM). מומלץ להתקין CUDA תואם ולוודא התקנת `requirements.txt` באמצעות `pip install -r requirements.txt`.
- ריצות חשובות אחרונות: `python tmp/run_short_walkforward.py` (בדיקת עשן) ו-`python tmp/run_short_walkforward.py --mode long ...` (ריצה של 600k timesteps לכל חלון, תוצרי JSON ב-`backend/evaluation/walk_forward_results/long_run_20251112`).
- נקודת המשך: לעדכן היפר-פרמטרים (entropy, learning rate, gradient clipping) ולהריץ מחדש הערכה סטוכסטית (`--stochastic-eval`).
- קונטקסט שיחה מרכזי: פתרון חגים בנתוני אינטרדיי → ריצת עשן קצרה → ריצה ארוכה של 3 חלונות → ניתוח תוצאות והפקת מסמך זה.
- לאחר הסנכרון במחשב החדש, להריץ `git pull`, לאמת שהמסמך והארטיפקטים זמינים, ולהמשיך בהכנות לריצה משופרת בהתאם לסעיפים לעיל.
